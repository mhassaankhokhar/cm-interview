stages:
  - build
variables:
  DOCKER_HOST: tcp://docker:2375/
  DOCKER_DRIVER: overlay2
build-job:
  stage: build
  image: jdrouet/docker-with-buildx:stable
  services:
    - docker:24-dind
  before_script:
    - echo "üîê Docker login"
    - echo "${DOCKER_PASS}" | docker login -u "${DOCKER_USER}" --password-stdin
    - docker buildx create --use
  script:
    - echo "Hello, $GITLAB_USER_LOGIN!"
    - docker buildx build --platform linux/amd64,linux/arm64 --push -t mhassaankhokhar/filter-stack:$CI_COMMIT_SHA .
  after_script:
    - docker logout

